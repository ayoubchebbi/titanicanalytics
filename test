// 1. Modification dans fscoCreateDeliveryPlanHelper.js
// Ajouter cette nouvelle fonction de filtrage pour les thérapies

const createTherapyFilter = (accountId) => {
    if (!accountId) {
        // Si pas de compte sélectionné, retourner un filtre qui ne retourne aucun résultat
        return {
            criteria: [{
                fieldPath: 'Id',
                operator: 'eq',
                value: 'impossible_value_to_disable_field'
            }]
        };
    }

    return {
        criteria: [{
            fieldPath: 'PASSCO_Patient__c',
            operator: 'eq',
            value: accountId
        }]
    };
}

// N'oubliez pas d'exporter cette fonction
export {
    prepareAddress,
    picklistValues,
    navigateToRecord,
    extractErrors,
    createAddressFilter,
    createWorkTypeFilter,
    createAccountLookupFilters,
    serviceResourceFilter,
    createTherapyFilter  // <-- Ajouter cette ligne
}

// 2. Modifications dans fscoCreateDeliveryPlan.js
// Ajouter cet import dans la section des imports depuis le helper
import { prepareAddress, 
        picklistValues, 
        navigateToRecord, 
        extractErrors,
        createAddressFilter,
        createWorkTypeFilter,
        createAccountLookupFilters,
        serviceResourceFilter,
        createTherapyFilter  // <-- Ajouter cette ligne
        } from './fscoCreateDeliveryPlanHelper';

// 3. Ajouter ce getter dans la classe FscoCreateDeliveryPlan
get therapyFilter() {
    return createTherapyFilter(this.formData.OSMCO_Account__c);
}

// 4. Modifier la méthode handleLookupAccountChange pour réinitialiser le champ thérapie
handleLookupAccountChange(event) {
    // Réinitialiser le champ thérapie quand le compte change
    if (this.formData.OSMCO_Therapy__c) {
        this.formData.OSMCO_Therapy__c = null;
    }
    
    this.formData.OSMCO_Account__c = event.detail.selectedIds[0];
    this.accountInit.id = this.formData.OSMCO_Account__c;
    this.accountInit.title = event.detail.selectedTitles[0] || undefined;
}

// 5. Alternative: Si vous voulez désactiver complètement le champ quand aucun compte n'est sélectionné
// Ajouter ce getter pour contrôler l'état disabled du champ thérapie
get isTherapyDisabled() {
    return !this.formData.OSMCO_Account__c;
}
