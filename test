Voici le code optimis√© :
public static List<FSL.AppointmentBookingSlot> getFreeSlot(Id appointmentId) {
    List<FSL.AppointmentBookingSlot> result = new List<FSL.AppointmentBookingSlot>();
    Map<String, FSL.AppointmentBookingSlot> slotMap = new Map<String, FSL.AppointmentBookingSlot>();
    
    DateTime now = DateTime.now();
    DateTime endDate = now.addSeconds((UserInfo.getTimezone().getOffset(now)/1000));
    
    try {
        ServiceAppointment appt = PointOfServiceAndChannelSchedulingHelper.getAppointmentDetails(appointmentId)[0];
        
        FSL.GradeSlotsService gradeService = new FSL.GradeSlotsService(getPolicy(appt), appt.Id);
        FSL.AdvancedGapMatrix gapMatrix = gradeService.getGradedMatrix(true);
        Map<Id, FSL.ResourceScheduleData> resourceData = gapMatrix.ResourceIDToScheduleData;
        
        for (Id resourceId : resourceData.keySet()) {
            for (FSL.SchedulingOption option : resourceData.get(resourceId).SchedulingOptions) {
                FSL.AppointmentBookingSlot slot = new FSL.AppointmentBookingSlot();
                slot.Interval = new FSL.TimeInterval(option.Interval.Start, option.Interval.Finish);
                result.add(slot);
            }
        }
        
        for (FSL.AppointmentBookingSlot slot : result) {
            DateTime start = slot.Interval.Start;
            DateTime end = slot.Interval.Finish;
            Decimal duration = appt.DurationType == ServiceAppointmentHelper.DURATION_TYPE_MINUTES ? 
                              appt.Duration : appt.Duration * 60;
            
            while(start.getTime() + (duration * 60000) <= end.getTime()) {
                DateTime newEnd = start.addMinutes(duration.intValue());
                
                if(start > endDate && newEnd > endDate) {
                    FSL.AppointmentBookingSlot newSlot = new FSL.AppointmentBookingSlot();
                    newSlot.Interval = new FSL.TimeInterval(start, newEnd);
                    
                    String key = slot.Interval.Start + '' + slot.Interval.Finish;
                    if(!slotMap.containsKey(key)) {
                        slotMap.put(key, newSlot);
                    }
                }
                
                start = newEnd;
            }
        }
        
        return slotMap.values();
        
    } catch (Exception e) {
        return new List<FSL.AppointmentBookingSlot>();
    }
}
