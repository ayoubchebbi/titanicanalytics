public EmergencyCheckWrapper getEmergencyCheck(Id saId) {
    EmergencyCheckWrapper emergencyCheckWrapper = new EmergencyCheckWrapper();

    // Single optimized SOQL query using Relationship Queries
    List<ServiceAppointment> saList = [
        SELECT Id, Latitude, Longitude, Status, AppointmentNumber, 
               ServiceTerritoryId,
               (SELECT Id, ServiceResource.Name, ServiceResource.LastKnownLatitude, 
                       ServiceResource.LastKnownLongitude 
                FROM ServiceTerritory.ServiceTerritoryMembers)
        FROM ServiceAppointment
        WHERE Id = :saId
    ];

    // Ensure the list is not empty before accessing elements
    if (!saList.isEmpty()) {
        ServiceAppointment sa = saList[0];  // Fetch first record safely

        emergencyCheckWrapper.appointmentNumber = sa.AppointmentNumber;
        emergencyCheckWrapper.latitude = sa.Latitude;
        emergencyCheckWrapper.longitude = sa.Longitude;
        emergencyCheckWrapper.status = sa.Status;

        // Populate Service Territory Members safely
        List<ServiceTerritoryMember> stmList = new List<ServiceTerritoryMember>();
        for (ServiceTerritoryMember stm : sa.ServiceTerritory.ServiceTerritoryMembers) {
            stmList.add(stm);
        }
        emergencyCheckWrapper.stmList = stmList;
    }

    return emergencyCheckWrapper;
}
